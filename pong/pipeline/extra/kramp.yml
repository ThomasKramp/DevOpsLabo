---
 - hosts: all
   become: yes
   vars:
    data_path: /data
    
   # ansible-playbook kramp.yml
   # ssh-keygen
   # cat ~/.ssh/id_rsa.pub
   # ssh-copy-id kramp@192.168.0.50

   tasks:
   - name: Update apt cache
     apt: 
       update_cache: yes
   
   - name: Install dependencies
     apt: 
       name: "{{ item }}"
       state: latest
       update_cache: yes
     loop: [ 'apt-transport-https', 'ca-certificates', 'curl', 'software-properties-common', 'gnupg-agent', 'python3-pip', 'python3-setuptools' ]
     
   - name: Add an apt signing key for Docker
     apt_key:
       url: https://download.docker.com/linux/ubuntu/gpg
       state: present

   - name: Add Docker Repository
     apt_repository:
       repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable
       state: present
   
   - name: Install Docker
     apt: 
       name: "{{ item }}"
       state: latest
       update_cache: yes
     loop: [ 'docker-ce', 'docker-ce-cli', 'containerd.io' ]
     
   - name: Install docker python extension
     pip:
       name: docker-py

   - name: Add user to docker group
     user:
       name: "{{ ansible_user }}"
       group: docker
   
   - name: copying file with playbook
     become: true 
     copy:
       src: ~/Documents/files/jenkins.tar.gz
       dest: /home/{{ ansible_user }}/Documents/
       owner: root
       group: root        
       mode: 0755

   - name: Install Jenkins
     docker_container:
      name: jenkins
      image: jenkins/jenkins:latest
      volumes:
       - "{{ data_path }}/jenkins:/var/jenkins_home"
      ports:
       - "8080:80"

   - name: Enable Jenkins
     command: "chmod a+rw {{ data_path }}/jenkins"
     args:
      warn: false
      
